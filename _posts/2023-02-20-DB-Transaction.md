---
layout: post
title: " [데이터베이스개론] 트랜잭션 "
categories: Database
author: devFancy
---
* content
{:toc}

> 이 글은 컴퓨터학부 수업인 `데이터베이스` 와 `데이터베이스 개론`을 공부하고 정리한 내용입니다.

## 트랜잭션

데이터베이스는 다수의 사용자가 동시에 사용하더라도 항상 **모순이 없는 정확한 데이터**를 유지해야 한다.

데이터베이스 관리 시스템은 데이터베이스가 항상 정확하고 일관된 상태를 유지할 수 있도록 다양한 기능을 제공하는데, 그 중심에는 `트랜잭션`이 있다.

`트랜잭션`은 작업 하나를 수행하는 데 필요한 데이터베이스의 연산들을 모아놓은 것으로, 데이터베이스에서 **논리적인 작업의 단위**가 된다. 그리고 데이터베이스에 장애가 발생했을 때 **데이터를 복구하는 작업의 단위**도 된다.

예를 들어, 인터넷뱅킹을 통해 계좌이체 작업을 완벽하게 수행하기 위해 2개의 데이터베이스 연산을 처리해야 한다면, 계좌이체 트랜잭션은 2개의 연산으로 구성할 수 있다.

이체하기 전의 팬시의 잔액은 20,000원이고 케빈의 잔액은 0원인 경우을 다음과 같이 정리했다.

[**이체하기 전**의 DB 상태]

```text
팬시 잔액 : 20,000원
케빈 잔액 :      0원
```

이때 팬시가 브루스에게 10,000원을 이체한 경우 계좌이체 트랜잭션은 다음과 같이 2개의 연산으로 구성할 수 있다.

(팬시의 계좌번호는 100, 케빈의 계좌번호는 200으로 가정한다)

[1] 팬시 계좌에서 10,000원 인출

```sql
UPDATE  계좌
SET     잔액 = 잔액 - 10,000
WHERE   계좌번호 = 100;
```

[2] 케빈 계좌에 10,000원 입금

```sql
UPDATE  계좌
SET     잔액 = 잔액 + 10,000
WHERE   계좌번호 = 200;
```

[**이체한 이후**의 DB 상태]

```text
팬시 잔액 : 10,000원
케빈 잔액 : 10,000원
```

여기서 중요한 점은 2개의 UPDATE 문이 **모두 완전하게 처리되어야 트랜잭션이 성공적으로 수행**한다는 것이다. 만약 둘 중 하나라도 처리 과정에서 오류가 발생한다면, 모든 명령문의 실행을 취소하고 트랜잭션 작업 전의 데이터베이스 상태로 되돌아가야 한다.

트랜잭션은 데이터베이스에 장애가 발생했을 때 복구 작업을 수행하거나, 다수의 사용자가 동시에 사용할 수 있도록 제어 작업을 하는데 중요한 단위로 사용된다.

그러므로 데이터베이스의 **무결성**과 **일관성**을 보장하려면 작업을 수행하는 데 필요한 연산들을 하나의 트랜잭션으로 제대로 정의하고 관리해야 한다.

## 트랜잭션 특성

트랜잭션이 성공적으로 처리되어 데이터베이스의 무결성과 일관성이 보장되려면 네 가지 특성을 모두 만족해야 한다. 트랜잭션의 네 가지 특성을 각 특성에 해당하는 영어 단어 첫 자를 따로 **ACID** 특성이라고 한다.

> [1] `원자성`(Atomicity) : 트랜잭션을 구성하는 연산들이 모두 정상적으로 실행되거나 하나도 실행되지 않아야 한다는 **All-Or-Nothing** 방식을 의미한다. 

만약 트랜잭션을 수행하다가 장애가 발생하여 작업을 완료하지 못했다면, 지금까지 실행한 연산 처리를 모두 취소하고 데이터베이스를 트랜잭션 작업 전의 상태로 되돌려 트랜잭션의 원자성을 보장해야 한다.

그러므로 트랜잭션의 원자성을 보장하려면 이처럼 장애가 발생했을 때 데이터베이스의 원래 상태로 복구하는 **회복 기능**이 필요하다.

`커밋`(Commit) : 여러 쿼리가 성공적으로 처리되었다고 확정하는 명령어로 트랜잭션 단위로 수행되며 **변경된 내용이 모두 영구적으로 저장**되는 것을 말한다. "커밋이 수행되었다."라는 것은 "**하나의 트랜잭션이 성공적으로 수행되었다.**"를 말한다.

`롤벡`(Rollback) : 에러나 여러 이슈 때문에 트랜잭션 전으로 돌려야 할 때 사용하는 것을 말한다.

> [2] `일관성`(Consistency) : 트랜잭션이 **성공적으로 수행된 이후**에도 데이터베이스가 **일관된 상태를 유지**해야 함을 의미한다.

> [3] `격리성`(Isolation) : 고립성이라고도 하는데 현재 수행 중인 트랜잭션이 완료될 때까지 트랜잭션이 생성한 중간 연산 결과에 **다른 트랜잭션들이 접근할 수 없음**을 의미한다.

**각 트랜잭션이 독립적으로 수행**될 수 있도록 다른 트랜잭션의 중간 연산 결과에 서로 접근하지 못하게 한다.

> [4] `지속성`(Durability) : 영속성이라고도 하는데 트랜잭션이 성공적으로 완료된 후 데이터베이스에 반영된 **수행 결과는 어떠한 경우에도 손실되지 않고 영구적**이어야 함을 의미한다.

즉, 시스템에 장애가 발생하더라도 트랜잭션 작업 결과는 없어지지 않고 데이터베이스에 그대로 남아 있어야 한다는 의미이다.

그러므로 트랜잭션의 지속성을 보장하려면 시스템에 장애가 발생했을 때 데이터베이스를 원래 상태로 복구하는 **회복 기능**이 필요하다.

원자성과 지속성의 공통점은 장애가 발생했을 때 데이터베이스를 원래 상태로 복구하는 **회복 기능**이 필요하다.

## 트랜잭션의 상태

트랜잭션은 아래의 그림처럼 5가지 상태 중 하나에 속하게 된다.

![](/assets/img/db/db-transaction-1.png)

1. `활동` 상태(**Active**) : 트랜잭션이 수행되기 시작하여 현재 수행 중인 상태를 말한다.

2. `부분 완료` 상태(**Partially committed**) : 트랜잭션의 마지막 연산이 실행된 직후의 상태를 말한다. 모든 연산의 처리가 끝났지만 트랜잭션이 수행된 최종 결과를 DB에 아직 반영하지 않은 상태이다.

3. `완료` 상태(**Committed**) : 트랜잭션이 성공적으로 완료되서 `commit` 연산을 실행한 상태를 말한다. 트랜잭션이 수행한 최종 결과를 DB에 반영하고 종료된다.

4. `실패` 상태(**Failed**) : H/W 혹은 S/W의 문제, 트랜잭션의 내부의 오류 등 여러 이유로 인해 장애가 발생하여 트랜잭션의 수행이 중단된 상태를 말한다. 더는 정상적으로 수행할 수 없을 때 실패 상태가 된다.

5. `철회` 상태(**Aborted**) : 트랜잭션을 수행하는 데 실패하여 `rollback` 연산을 실행한 상태를 말한다. 철회 상태가 되면 지금까지 실행한 트랜잭션의 연산을 모두 취소하고 트랜잭션이 수행되기 전의 DB 상태로 되돌리면서 트랜잭션이 종료된다.

---

## 예상 질문

* 트랜잭션이란 무엇인가요?

* 트랜잭션의 특성 4가지에 대해 설명해 주세요.

* 트랜잭션의 상태 5가지에 대해 설명해 주세요.


## Reference

* [데이터베이스 개론](https://product.kyobobook.co.kr/detail/S000001743852)

* 컴퓨터학부 데이터베이스 강의자료